<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anonymous Grief Wall</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9f4f3;
    margin: 0; padding: 0;
    display: flex; flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  header {
    background: #ab6c82;
    color: white;
    padding: 1.5rem;
    text-align: center;
    width: 100%;
  }
  main {
    max-width: 700px;
    width: 90%;
    margin: 1.5rem auto 3rem;
  }
  form {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 3px 10px rgb(0 0 0 / 0.1);
    margin-bottom: 2rem;
  }
  textarea {
    width: 100%;
    height: 90px;
    resize: vertical;
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    margin-bottom: 1rem;
  }
  button {
    background: #ab6c82;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }
  button:disabled {
    background: #d6a5b8;
    cursor: not-allowed;
  }
  .messages {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .message-card {
    background: white;
    padding: 1rem 1.3rem;
    border-radius: 8px;
    box-shadow: 0 1px 5px rgb(0 0 0 / 0.1);
    white-space: pre-wrap;
    font-size: 1.1rem;
  }
  .footer {
    text-align: center;
    color: #999;
    margin-bottom: 2rem;
    font-size: 0.9rem;
  }
</style>
</head>
<body>

<header>
  <h1>Anonymous Grief Wall</h1>
  <p>Share your unsent words. Messages appear publicly and anonymously.</p>
</header>

<main>
  <form id="griefForm">
    <textarea id="messageInput" placeholder="Write your message here..." required minlength="5"></textarea>
    <button type="submit">Send Message</button>
  </form>

  <section class="messages" id="messagesContainer">
    <p>Loading messages...</p>
  </section>
</main>

<div class="footer">
  Created with ❤️ using GitHub Pages and GitHub Issues API
</div>

<script>
  const repoOwner = 'baozers'; // <== Change this
  const repoName = 'goodbyesneversaid'; // <== Change this
  const messagesContainer = document.getElementById('messagesContainer');
  const form = document.getElementById('griefForm');
  const messageInput = document.getElementById('messageInput');
  const GITHUB_API = `https://api.github.com/repos/${repoOwner}/${repoName}/issues`;

  // Fetch public issues from your repo and display as messages
  async function loadMessages() {
    messagesContainer.innerHTML = '<p>Loading messages...</p>';
    try {
      const response = await fetch(`${GITHUB_API}?per_page=30&state=open&labels=grief-message`);
      if (!response.ok) throw new Error('Failed to load messages');
      const issues = await response.json();
      if (issues.length === 0) {
        messagesContainer.innerHTML = '<p>No messages yet. Be the first to share.</p>';
        return;
      }
      messagesContainer.innerHTML = '';
      issues.forEach(issue => {
        const div = document.createElement('div');
        div.className = 'message-card';
        // Show issue body only — no user info to keep anonymous
        div.textContent = issue.body;
        messagesContainer.appendChild(div);
      });
    } catch (error) {
      messagesContainer.innerHTML = `<p style="color:red;">Error loading messages: ${error.message}</p>`;
    }
  }

  // Submit a new grief message by creating a GitHub Issue via API
  async function submitMessage(message) {
    const url = `https://api.github.com/repos/${repoOwner}/${repoName}/issues`;
    // We send anonymous issues using a GitHub personal access token, but since that exposes your token, instead:
    // **Workaround:** Use GitHub's **anonymous issue creation** via the public API **does not exist**. 
    // So this won't work without a backend or your token.
    // But there is a hack: You can use a **GitHub Actions** workflow or a third-party proxy API.
    // For demo, we will show how to do this with a **GitHub personal access token** (PAT) — **DO NOT publish your token publicly!**

    alert('Due to GitHub API limitations, submitting messages directly from the browser requires a personal access token, which is not secure in client-side code.\n\nTo accept public anonymous submissions, you must use a backend or a third-party service.');

    // This placeholder code shows how you would submit with token:
    /*
    const token = 'YOUR_PERSONAL_ACCESS_TOKEN'; // NEVER expose this in public code!
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': 'token ' + token,
        'Accept': 'application/vnd.github.v3+json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        title: message.substring(0, 50) || 'New grief message',
        body: message,
        labels: ['grief-message']
      })
    });
    if (!response.ok) throw new Error('Failed to submit message');
    */

  }

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const message = messageInput.value.trim();
    if (!message || message.length < 5) {
      alert('Please enter a message at least 5 characters long.');
      return;
    }
    // Disable form while submitting
    form.querySelector('button').disabled = true;

    try {
      await submitMessage(message);
      alert('Message submission requires backend setup. See README.');
      messageInput.value = '';
    } catch (err) {
      alert('Error submitting message: ' + err.message);
    } finally {
      form.querySelector('button').disabled = false;
    }
  });

  loadMessages();
</script>

</body>
</html>
